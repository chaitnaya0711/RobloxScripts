local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- Create GUI elements
local ScreenGui = Instance.new("ScreenGui")
local BlurEffect = Instance.new("BlurEffect")
local MainFrame = Instance.new("Frame")
local OpenButton = Instance.new("TextButton")
local CloseButton = Instance.new("TextButton")
local PlayerList = Instance.new("ScrollingFrame")
local UICorner = Instance.new("UICorner")
local ListLayout = Instance.new("UIListLayout")
local Title = Instance.new("TextLabel")

-- Setup blur effect
BlurEffect.Parent = game:GetService("Lighting")
BlurEffect.Size = 0

-- GUI Properties
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Open Button
OpenButton.Parent = ScreenGui
OpenButton.Position = UDim2.new(0.9, 0, 0.1, 0)
OpenButton.Size = UDim2.new(0.08, 0, 0.05, 0)
OpenButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
OpenButton.Text = "Open"
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.Font = Enum.Font.GothamBold
OpenButton.TextSize = 14
OpenButton.AutoButtonColor = true
Instance.new("UICorner", OpenButton).CornerRadius = UDim.new(0.2, 0)

-- Main Frame
MainFrame.Parent = ScreenGui
MainFrame.Position = UDim2.new(0.5, 0, 1.5, 0)
MainFrame.Size = UDim2.new(0.4, 0, 0.6, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BackgroundTransparency = 0.1
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0.02, 0)

-- Title
Title.Parent = MainFrame
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Size = UDim2.new(1, 0, 0.1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Player List"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

-- Close Button
CloseButton.Parent = MainFrame
CloseButton.Position = UDim2.new(0.9, 0, 0.02, 0)
CloseButton.Size = UDim2.new(0.08, 0, 0.06, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.AutoButtonColor = true
Instance.new("UICorner", CloseButton).CornerRadius = UDim.new(0.2, 0)

-- Player List
PlayerList.Parent = MainFrame
PlayerList.Position = UDim2.new(0.025, 0, 0.12, 0)
PlayerList.Size = UDim2.new(0.95, 0, 0.85, 0)
PlayerList.BackgroundTransparency = 0.9
PlayerList.BorderSizePixel = 0
PlayerList.ScrollBarThickness = 6
Instance.new("UICorner", PlayerList).CornerRadius = UDim.new(0.02, 0)

-- List Layout
ListLayout.Parent = PlayerList
ListLayout.Padding = UDim.new(0, 5)
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ListLayout.SortOrder = Enum.SortOrder.Name

-- Function to convert days to appropriate time units
local function convertAccountAge(days)
    if days < 30 then
        return days .. " days"
    elseif days < 365 then
        local months = math.floor(days / 30)
        local remainingDays = days % 30
        return months .. " months" .. (remainingDays > 0 and " " .. remainingDays .. " days" or "")
    else
        local years = math.floor(days / 365)
        local remainingMonths = math.floor((days % 365) / 30)
        return years .. " years" .. (remainingMonths > 0 and " " .. remainingMonths .. " months" or "")
    end
end

-- Function to create player buttons with dynamic sizing
local function createPlayerButton(plr)
    local PlayerButton = Instance.new("Frame")
    PlayerButton.Size = UDim2.new(0.95, 0, 0, 50)
    PlayerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    PlayerButton.BackgroundTransparency = 0.3
    Instance.new("UICorner", PlayerButton).CornerRadius = UDim.new(0.1, 0)
    
    local PlayerName = Instance.new("TextLabel")
    PlayerName.Parent = PlayerButton
    PlayerName.Position = UDim2.new(0.02, 0, 0, 0)
    PlayerName.Size = UDim2.new(0.8, 0, 0.5, 0)
    PlayerName.BackgroundTransparency = 1
    PlayerName.Text = plr.Name
    PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayerName.Font = Enum.Font.GothamBold
    PlayerName.TextSize = 14
    PlayerName.TextXAlignment = Enum.TextXAlignment.Left

    local AccountAge = Instance.new("TextLabel")
    AccountAge.Parent = PlayerButton
    AccountAge.Position = UDim2.new(0.02, 0, 0.5, 0)
    AccountAge.Size = UDim2.new(0.96, 0, 0.5, 0)
    AccountAge.BackgroundTransparency = 1
    AccountAge.Text = "Account Age: " .. convertAccountAge(plr.AccountAge)
    AccountAge.TextColor3 = Color3.fromRGB(200, 200, 200)
    AccountAge.Font = Enum.Font.Gotham
    AccountAge.TextSize = 12
    AccountAge.TextXAlignment = Enum.TextXAlignment.Left

    -- Add click functionality
    local Button = Instance.new("TextButton")
    Button.Parent = PlayerButton
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""

    -- Hover animation
    Button.MouseEnter:Connect(function()
        TweenService:Create(PlayerButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(80, 80, 80)}):Play()
    end)

    Button.MouseLeave:Connect(function()
        TweenService:Create(PlayerButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
    end)

    -- Click functionality
    Button.MouseButton1Click:Connect(function()
        local accountValue = plr:GetAttribute("AccountValue") or 0
        local userId = plr.UserId
        local localId = plr.LocalId
        local premium = Players:GetUserPremium(plr.UserId) and "Yes" or "No"
        
        local dataToCopy = string.format("Username: %s\nDisplayName: %s\nUserId: %d\nLocalId: %d\nAccountValue: %d\nPremium: %s\nAccountAge: %s", 
                                           plr.Name, plr.DisplayName, userId, localId, accountValue, premium, convertAccountAge(plr.AccountAge))

        if setclipboard then
            setclipboard(dataToCopy)
            -- Create notification
            local notification = Instance.new("TextLabel")
            notification.Parent = MainFrame
            notification.Position = UDim2.new(0.5, 0, 0.9, 0)
            notification.AnchorPoint = Vector2.new(0.5, 1)
            notification.Size = UDim2.new(0.4, 0, 0.06, 0)
            notification.BackgroundColor3 = Color3.fromRGB(60, 200, 60)
            notification.TextColor3 = Color3.fromRGB(255, 255, 255)
            notification.Text = "Player information copied!"
            notification.Font = Enum.Font.Gotham
            notification.TextSize = 14
            Instance.new("UICorner", notification).CornerRadius = UDim.new(0.2, 0)

            -- Animate notification
            notification.BackgroundTransparency = 1
            notification.TextTransparency = 1
            TweenService:Create(notification, TweenInfo.new(0.3), {BackgroundTransparency = 0, TextTransparency = 0}):Play()
            task.wait(2)
            TweenService:Create(notification, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            task.wait(0.3)
            notification:Destroy()
        end
    end)

    PlayerButton.Parent = PlayerList
end

-- Button Events
OpenButton.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.5), {Position = UDim2.new(0.5, 0, 0.5, 0)}):Play()
    TweenService:Create(BlurEffect, TweenInfo.new(0.5), {Size = 24}):Play()
    -- Populate player list
    for _, plr in pairs(Players:GetPlayers()) do
        createPlayerButton(plr)
    end
end)

CloseButton.MouseButton1Click:Connect(function()
    TweenService:Create(MainFrame, TweenInfo.new(0.5), {Position = UDim2.new(0.5, 0, 1.5, 0)}):Play()
    TweenService:Create(BlurEffect, TweenInfo.new(0.5), {Size = 0}):Play()
end)

-- Clean up on GUI close
CloseButton.MouseButton1Click:Connect(function()
    for _, v in ipairs(PlayerList:GetChildren()) do
        if v:IsA("Frame") then
            v:Destroy()
        end
    end
end)

-- Update Player List on PlayerAdded
Players.PlayerAdded:Connect(function(plr)
    createPlayerButton(plr)
end)

-- Update Player List on PlayerRemoving
Players.PlayerRemoving:Connect(function(plr)
    for _, v in ipairs(PlayerList:GetChildren()) do
        if v:IsA("Frame") and v:FindFirstChild("TextLabel").Text == plr.Name then
            v:Destroy()
            break
        end
    end
end)
