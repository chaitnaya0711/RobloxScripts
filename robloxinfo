local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")

-- Create GUI elements
local ScreenGui = Instance.new("ScreenGui")
local BlurEffect = Instance.new("BlurEffect")
local MainFrame = Instance.new("Frame")
local OpenButton = Instance.new("TextButton")
local CloseButton = Instance.new("TextButton")
local PlayerList = Instance.new("ScrollingFrame")
local UICorner = Instance.new("UICorner")
local ListLayout = Instance.new("UIListLayout")
local Title = Instance.new("TextLabel")

-- Setup blur effect
BlurEffect.Parent = game:GetService("Lighting")
BlurEffect.Size = 0

-- GUI Properties
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Open Button
OpenButton.Parent = ScreenGui
OpenButton.Position = UDim2.new(0.9, 0, 0.1, 0)
OpenButton.Size = UDim2.new(0.08, 0, 0.05, 0)
OpenButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
OpenButton.Text = "Open"
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.Font = Enum.Font.GothamBold
OpenButton.TextSize = 14
OpenButton.AutoButtonColor = true
Instance.new("UICorner", OpenButton).CornerRadius = UDim.new(0.2, 0)

-- Main Frame
MainFrame.Parent = ScreenGui
MainFrame.Position = UDim2.new(0.5, 0, 1.5, 0)
MainFrame.Size = UDim2.new(0.4, 0, 0.6, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BackgroundTransparency = 0.1
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0.02, 0)

-- Title
Title.Parent = MainFrame
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Size = UDim2.new(1, 0, 0.1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Player List"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

-- Close Button
CloseButton.Parent = MainFrame
CloseButton.Position = UDim2.new(0.9, 0, 0.02, 0)
CloseButton.Size = UDim2.new(0.08, 0, 0.06, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.AutoButtonColor = true
Instance.new("UICorner", CloseButton).CornerRadius = UDim.new(0.2, 0)

-- Player List
PlayerList.Parent = MainFrame
PlayerList.Position = UDim2.new(0.025, 0, 0.12, 0)
PlayerList.Size = UDim2.new(0.95, 0, 0.85, 0)
PlayerList.BackgroundTransparency = 0.9
PlayerList.BorderSizePixel = 0
PlayerList.ScrollBarThickness = 6
Instance.new("UICorner", PlayerList).CornerRadius = UDim.new(0.02, 0)

-- List Layout
ListLayout.Parent = PlayerList
ListLayout.Padding = UDim.new(0, 5)
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ListLayout.SortOrder = Enum.SortOrder.Name

-- Function to convert days to appropriate time units
local function convertAccountAge(days)
    if days < 30 then
        return days .. " days"
    elseif days < 365 then
        local months = math.floor(days / 30)
        local remainingDays = days % 30
        return months .. " months" .. (remainingDays > 0 and " " .. remainingDays .. " days" or "")
    else
        local years = math.floor(days / 365)
        local remainingMonths = math.floor((days % 365) / 30)
        return years .. " years" .. (remainingMonths > 0 and " " .. remainingMonths .. " months" or "")
    end
end

-- Function to calculate join date based on account age
local function calculateJoinDate(accountAge)
    local joinDate = os.date("*t") -- Get current date
    joinDate.year = joinDate.year - math.floor(accountAge / 365)
    joinDate.month = joinDate.month - ((accountAge % 365) // 30) -- Get the remaining months
    joinDate.day = joinDate.day -- Keep the day as is (may need adjustments)
    
    -- Adjust the month and day if needed
    if joinDate.month <= 0 then
        joinDate.year = joinDate.year - 1
        joinDate.month = 12 + joinDate.month
    end
    
    return os.date("%Y-%m-%d", os.time(joinDate))
end

-- Function to get player avatar information
local function getPlayerAvatarImageUrl(playerId)
    return "https://www.roblox.com/headshot-thumbnail/image?userId=" .. playerId .. "&width=420&height=420&format=png"
end

-- Function to create player buttons with dynamic sizing
local function createPlayerButton(plr)
    local PlayerButton = Instance.new("Frame")
    PlayerButton.Size = UDim2.new(0.95, 0, 0, 50)
    PlayerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    PlayerButton.BackgroundTransparency = 0.3
    
    local PlayerName = Instance.new("TextLabel")
    PlayerName.Parent = PlayerButton
    PlayerName.Position = UDim2.new(0.02, 0, 0, 0)
    PlayerName.Size = UDim2.new(0.96, 0, 0.5, 0)
    PlayerName.BackgroundTransparency = 1
    PlayerName.Text = plr.Name
    PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayerName.Font = Enum.Font.GothamBold
    PlayerName.TextSize = 14
    PlayerName.TextXAlignment = Enum.TextXAlignment.Left
    
    local AccountAge = Instance.new("TextLabel")
    AccountAge.Parent = PlayerButton
    AccountAge.Position = UDim2.new(0.02, 0, 0.5, 0)
    AccountAge.Size = UDim2.new(0.96, 0, 0.5, 0)
    AccountAge.BackgroundTransparency = 1
    AccountAge.Text = "Account Age: " .. convertAccountAge(plr.AccountAge)
    AccountAge.TextColor3 = Color3.fromRGB(200, 200, 200)
    AccountAge.Font = Enum.Font.Gotham
    AccountAge.TextSize = 12
    AccountAge.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Add corner radius
    Instance.new("UICorner", PlayerButton).CornerRadius = UDim.new(0.1, 0)
    
    -- Make entire frame clickable
    local Button = Instance.new("TextButton")
    Button.Parent = PlayerButton
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    
    -- Hover animation
    Button.MouseEnter:Connect(function()
        TweenService:Create(PlayerButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(80, 80, 80)}):Play()
    end)
    
    Button.MouseLeave:Connect(function()
        TweenService:Create(PlayerButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
    end)
    
    -- Click functionality
    Button.MouseButton1Click:Connect(function()
        local userId = plr.UserId
        local displayName = plr.DisplayName
        local joinedDate = calculateJoinDate(plr.AccountAge)
        local premium = plr.MembershipType == Enum.MembershipType.Premium and "Yes" or "No"
        local avatarImageUrl = getPlayerAvatarImageUrl(userId)

        local infoToCopy = string.format(
            "Username: %s\nUser ID: %s\nDisplay Name: %s\nAccount Age: %s\nPremium: %s\nJoin Date: %s\nAvatar Image URL: %s",
            plr.Name, userId, displayName, convertAccountAge(plr.AccountAge), premium, joinedDate, avatarImageUrl
        )
        
        setclipboard(infoToCopy)

        -- Create notification
        local notification = Instance.new("TextLabel")
        notification.Parent = ScreenGui
        notification.Size = UDim2.new(0.5, 0, 0.1, 0)
        notification.Position = UDim2.new(0.5, 0, 0.5, 0)
        notification.AnchorPoint = Vector2.new(0.5, 0.5)
        notification.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        notification.TextColor3 = Color3.fromRGB(0, 0, 0)
        notification.Font = Enum.Font.GothamBold
        notification.TextSize = 14
        notification.Text = "Copied player info to clipboard!"
        notification.BackgroundTransparency = 0.5
        notification.BorderSizePixel = 0
        
        -- Fade out notification
        TweenService:Create(notification, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()
        wait(1)
        notification:Destroy()
    end)
    
    PlayerButton.Parent = PlayerList
end

-- Function to update player list
local function updatePlayerList()
    for _, child in ipairs(PlayerList:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    for _, plr in ipairs(Players:GetPlayers()) do
        createPlayerButton(plr)
    end
end

-- Open and close button functionality
OpenButton.MouseButton1Click:Connect(function()
    MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    BlurEffect.Size = 24
    updatePlayerList()
end)

CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Position = UDim2.new(0.5, 0, 1.5, 0)
    BlurEffect.Size = 0
end)

-- Handle mobile touches
OpenButton.MouseButton1Down:Connect(OpenButton.MouseButton1Click)
CloseButton.MouseButton1Down:Connect(CloseButton.MouseButton1Click)

-- Update player list when a player joins or leaves
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)
